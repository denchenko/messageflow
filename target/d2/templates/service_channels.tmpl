{{- $hasReceiveFrom := false -}}
{{- $hasSendTo := false -}}
{{- $hasReplyTo := false -}}
{{- $hasRequestFrom := false -}}
{{- range .Operation }}
  {{- if and (eq .Action "receive") (not .Reply) }}
    {{- $hasReceiveFrom = true }}
  {{- end }}
  {{- if and (eq .Action "send") (not .Reply) }}
    {{- $hasSendTo = true }}
  {{- end }}
  {{- if and (eq .Action "receive") .Reply }}
    {{- $hasReplyTo = true }}
  {{- end }}
  {{- if and (eq .Action "send") .Reply }}
    {{- $hasRequestFrom = true }}
  {{- end }}
{{- end }}
{{- if $hasReceiveFrom -}}
'Receive From': {
  grid-columns: 2

{{- range .Operation }}
  {{- if and (eq .Action "receive") (not .Reply) }}
'{{.Channel.Name}}': { 
  shape: queue
  {{- if .Channel.Message }}
  tooltip: ||json
{{.Channel.Message}}
  ||
  {{- end }}
}
  {{- end }}
{{- end }}
}
{{- end }}

{{- if $hasSendTo }}
'Send To': {
  grid-columns: 2

  {{- range .Operation }}
    {{- if and (eq .Action "send") (not .Reply) }}
  '{{.Channel.Name}}': { 
    shape: queue
{{- if .Channel.Message }}
    tooltip: ||json
{{.Channel.Message}}
    ||
    {{- end }}
  }
    {{- end }}
  {{- end }}
}
{{- end }}

{{- if $hasReplyTo }}
'Reply To': {
  grid-columns: 2

  {{- range .Operation }}
    {{- if and (eq .Action "receive") .Reply }}
  '{{.Channel.Name}}': { 
    shape: queue
    {{- if or .Channel.Message .Reply.Message }}
    tooltip: ||json
Request:
{{.Channel.Message}}
Reply:
{{.Reply.Message}}
    ||
    {{- end }}
  }
    {{- end }}
  {{- end }}
}
{{- end }}

{{- if $hasRequestFrom }}
'Request From': {
  grid-columns: 2

  {{- range .Operation }}
    {{- if and (eq .Action "send") .Reply }}
  '{{.Channel.Name}}': { 
    shape: queue
    {{- if or .Channel.Message .Reply.Message }}
    tooltip: ||json
Request:
{{.Channel.Message}}
Reply:
{{.Reply.Message}}
    ||
    {{- end }}
  }
    {{- end }}
  {{- end }}
}
{{- end }}

{{- if $hasReceiveFrom }}
'Receive From' -> '{{.Name}}'
{{- end }}
{{- if $hasSendTo }}
'{{.Name}}' -> 'Send To'
{{- end }}
{{- if $hasReplyTo }}
'Reply To' -> '{{.Name}}'
{{- end }}
{{- if $hasRequestFrom }}
'{{.Name}}' -> 'Request From'
{{- end }}
